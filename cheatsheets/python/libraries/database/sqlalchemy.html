<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">



    <meta property="og:site_name" content="Dev Cheatsheets" />

    <title>SQLAlchemy | Dev Cheatsheets</title>

    <meta property="og:title" content="SQLAlchemy" />

    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="SQLAlchemy" />
<meta name="generator" content="Jekyll v4.4.1" />

<meta property="og:locale" content="en_US" />


    <meta name="description" content="SQLAlchemy is the Python SQL toolkit and Object Relational Mapper that gives application developers the full power and flexibility of SQL.
" />
    <meta property="og:description" content="SQLAlchemy is the Python SQL toolkit and Object Relational Mapper that gives application developers the full power and flexibility of SQL.
" />
<meta name="author" content="Michael Currin" />



<link rel="canonical" href="https://michaelcurrin.github.io/dev-cheatsheets/cheatsheets/python/libraries/database/sqlalchemy.html" />
<meta property="og:url" content="https://michaelcurrin.github.io/dev-cheatsheets/cheatsheets/python/libraries/database/sqlalchemy.html" />


<script type="application/ld+json">
{
    "name":        "Dev Cheatsheets",
    "description": "SQLAlchemy is the Python SQL toolkit and Object Relational Mapper that gives application developers the full power and flexibility of SQL.
",
    "url":         "https://michaelcurrin.github.io/dev-cheatsheets/cheatsheets/python/libraries/database/sqlalchemy.html",
    "headline":    "SQLAlchemy",
    "@type":       "WebSite",
    "@context":    "https://schema.org",
    "author": {
        "@type":"Person",
        "name": "Michael Currin"
    }
}
</script>
<link rel="stylesheet" href="/dev-cheatsheets/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://michaelcurrin.github.io/dev-cheatsheets/feed.xml" title="Dev Cheatsheets" /><script async src="https://www.googletagmanager.com/gtag/js?id=UA-87705880-12"></script>
    <script>
        window['ga-disable-UA-87705880-12'] = window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1";
        window.dataLayer = window.dataLayer || [];

        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-87705880-12');
    </script></head>
<body>
<header class="site-header" role="banner">

    <div class="wrapper"><a class="site-title" rel="author" href="/dev-cheatsheets/">
            Dev Cheatsheets
        </a><nav class="site-nav">
            <input type="checkbox" id="nav-trigger" class="nav-trigger" />

            <label for="nav-trigger">
                <span class="menu-icon">
                    <svg viewBox="0 0 18 15" width="18px" height="15px">
                        <path
                            d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
                    </svg>
                </span>
            </label>

            <div class="trigger"><a class="page-link" href="/dev-cheatsheets/">
                    Home
                </a><a class="page-link" href="/dev-cheatsheets/cheatsheets/">
                    Cheatsheets
                </a><a class="page-link" href="/dev-cheatsheets/about.html">
                    About
                </a><a class="ext-link page-link" href="https://michaelcurrin.github.io/code-cookbook/">
                    <span>Code Cookbook</span>
                    <img src="/dev-cheatsheets/assets/ext-link.svg" />
                </a><a class="ext-link page-link" href="https://michaelcurrin.github.io/dev-resources/">
                    <span>Dev Resources</span>
                    <img src="/dev-cheatsheets/assets/ext-link.svg" />
                </a></div>
        </nav></div>
</header>
<main class="page-content" aria-label="Content">
        <div class="wrapper">
            <a id="github-edit" href="https://github.com/MichaelCurrin/dev-cheatsheets/edit/master/cheatsheets/python/libraries/database/sqlalchemy.md">
    üìù <span>Edit page</span>
</a>

            <a id="github-add" href="https://github.com/MichaelCurrin/dev-cheatsheets/new/master/cheatsheets/python/libraries/database/">
    ‚ûï <span>Add page</span>
</a>


            

<article class="post">
    <header class="post-header">
        <h1 class="post-title">
            


            <span>SQLAlchemy</span>
        </h1>

        
            <blockquote>
                <p>SQLAlchemy is the Python SQL toolkit and Object Relational Mapper that gives application developers the full power and flexibility of SQL.</p>

            </blockquote>
        
    </header>

    


    <div id="breadcrumbs">

    
        

        
            
            <a href="/dev-cheatsheets/cheatsheets/">
    Cheatsheets
</a>

        
     
        
            /
        

        
            
            <a href="/dev-cheatsheets/cheatsheets/python/">
    Python
</a>

        
     
        
            /
        

        
            
            <a href="/dev-cheatsheets/cheatsheets/python/libraries/">
    Libraries
</a>

        
     
        
            /
        

        
            
            <a href="/dev-cheatsheets/cheatsheets/python/libraries/database/">
    Databases
</a>

        
     
        
            /
        

        
            <a href="/dev-cheatsheets/cheatsheets/python/libraries/database/sqlalchemy.html" class="underline">
                SQLAlchemy
            </a>
        
     
    </div>



    <br>

    <div class="post-content">
        
            <ul>
  <li><a href="https://www.sqlalchemy.org/">Homepage</a></li>
  <li><a href="https://docs.sqlalchemy.org/en/20/">Docs</a> for V2</li>
</ul>

<h2 id="features">Features</h2>

<p><a href="https://www.sqlalchemy.org/features.html">Features</a> in docs</p>

<h3 id="db-types">DB types</h3>

<ul>
  <li>PostgreSQL</li>
  <li>MySQL</li>
  <li>SQLite</li>
  <li>Oracle</li>
  <li>Microsoft SQL Server</li>
</ul>

<h3 id="both-raw-sql-and-orm-support">Both raw SQL and ORM support</h3>

<p>Use raw SQL queries or use it as an ORM.</p>

<p>To help with the raw SQL, you can use SQL Expression Language which allows expression of the SQL language via generative Python expressions. There‚Äôs also support to work with existing schemas and use DB types.</p>

<h2 id="examples">Examples</h2>

<h3 id="create-instance">Create instance</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">engine</span> <span class="o">=</span> <span class="nf">create_engine</span><span class="p">(</span><span class="sh">'</span><span class="s">sqlite:///bookstore.db</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<p>Or</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">db_path</span> <span class="o">=</span> <span class="sh">"</span><span class="s">bookstore.db</span><span class="sh">"</span>
<span class="n">engine</span> <span class="o">=</span> <span class="nf">create_engine</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">sqlite:///</span><span class="si">{</span><span class="n">db_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="raw-sql">Raw SQL</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">query</span> <span class="o">=</span> <span class="sh">"</span><span class="s">SELECT * FROM tweets</span><span class="sh">"</span>

<span class="k">with</span> <span class="nf">get_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="n">cursor</span><span class="p">.</span><span class="nf">fetchall</span><span class="p">()</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">query</span><span class="p">.</span><span class="n">cursor</span><span class="p">.</span><span class="n">description</span><span class="p">]</span>

<span class="nf">print</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="orm">ORM</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">metadata</span> <span class="o">=</span> <span class="nc">MetaData</span><span class="p">()</span>

<span class="n">books</span> <span class="o">=</span> <span class="nc">Table</span><span class="p">(</span><span class="sh">'</span><span class="s">book</span><span class="sh">'</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="nc">Column</span><span class="p">(</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="nc">Column</span><span class="p">(</span><span class="sh">'</span><span class="s">title</span><span class="sh">'</span><span class="p">,</span> <span class="n">String</span><span class="p">),</span>
    <span class="nc">Column</span><span class="p">(</span><span class="sh">'</span><span class="s">primary_author</span><span class="sh">'</span><span class="p">,</span> <span class="n">String</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">engine</span> <span class="o">=</span> <span class="nf">create_engine</span><span class="p">(</span><span class="sh">'</span><span class="s">sqlite:///bookstore.db</span><span class="sh">'</span><span class="p">)</span>
<span class="n">metadata</span><span class="p">.</span><span class="nf">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="sql-expression-language">SQL Expression language</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sqlalchemy.sql</span> <span class="kn">import</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">select</span>

<span class="n">t</span> <span class="o">=</span> <span class="nf">table</span><span class="p">(</span><span class="sh">'</span><span class="s">t</span><span class="sh">'</span><span class="p">,</span> <span class="nf">column</span><span class="p">(</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">))</span>
<span class="n">s</span> <span class="o">=</span> <span class="nf">select</span><span class="p">(</span><span class="n">t</span><span class="p">).</span><span class="nf">where</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">c</span><span class="p">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">compile</span><span class="p">(</span><span class="n">compile_kwargs</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">literal_binds</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">}))</span>
</code></pre></div></div>

<h3 id="stringify-query">Stringify query</h3>

<p>From FAQs in the docs.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sqlalchemy</span> <span class="kn">import</span> <span class="n">table</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">select</span>


<span class="n">t</span> <span class="o">=</span> <span class="nf">table</span><span class="p">(</span><span class="sh">'</span><span class="s">my_table</span><span class="sh">'</span><span class="p">,</span> <span class="nf">column</span><span class="p">(</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">))</span>
<span class="n">statement</span> <span class="o">=</span> <span class="nf">select</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="nf">str</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
<span class="c1"># SELECT my_table.x
# FROM my_table
</span></code></pre></div></div>

<h3 id="set-up-and-fetch">Set up and fetch</h3>

<p>This is my own logic to put low-level logic in functions for easy reuse.</p>

<p>Here we get row data and field names (on the <code class="language-plaintext highlighter-rouge">.description</code> attribute) from a SQLite database, using the SQLAlchemy library.</p>

<p>Note use of <code class="language-plaintext highlighter-rouge">with</code> block to automatically close the connection after the query is done, or even if it fails.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>


<span class="k">def</span> <span class="nf">get_connection</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">
    Create and return a connection to the configured SQLite database.`
    </span><span class="sh">"""</span>
    <span class="k">assert</span> <span class="n">os</span><span class="p">.</span><span class="nf">access</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">DB_PATH</span><span class="p">,</span> <span class="n">os</span><span class="p">.</span><span class="n">R_OK</span><span class="p">),</span> <span class="p">(</span>
        <span class="sh">"</span><span class="s">Create the database or symlink then restart the application.</span><span class="sh">"</span>
        <span class="sh">"</span><span class="s"> Expected path: {}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">DB_PATH</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">sql_engine</span> <span class="o">=</span> <span class="nf">create_engine</span><span class="p">(</span><span class="sh">"</span><span class="s">sqlite:///{}</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">config</span><span class="p">.</span><span class="n">DB_PATH</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">sql_engine</span><span class="p">.</span><span class="nf">connect</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">fetch_data</span><span class="p">(</span><span class="n">query</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Expect a SQL query, execute it and return rows and field names.
    </span><span class="sh">"""</span>
    <span class="k">with</span> <span class="nf">get_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="n">cursor</span><span class="p">.</span><span class="nf">fetchall</span><span class="p">()</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">query</span><span class="p">.</span><span class="n">cursor</span><span class="p">.</span><span class="n">description</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">rows</span><span class="p">,</span> <span class="n">fields</span>
</code></pre></div></div>

        
    </div>
</article>

        </div>
    </main>
<footer class="site-footer h-card">
    <data class="u-url" href="/dev-cheatsheets/"></data>

    <div class="wrapper">

        <h2 class="footer-heading">Dev Cheatsheets</h2>

        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list"><li class="p-name">
                            Michael Currin
                        </li></ul>
            </div>

            <div class="footer-col footer-col-2">
<ul class="social-media-list"><li>
        <a href="https://github.com/MichaelCurrin"><svg
                class="svg-icon">
                <use xlink:href="/dev-cheatsheets/assets/fractal-social-icons.svg#github">
                </use>
            </svg> <span class="username">MichaelCurrin</span></a>
    </li></ul>
</div>

            <div class="footer-col footer-col-3">
                <p>A collection of code snippets and CLI guides for quick and easy reference while coding</p>
            </div>
        </div>

    </div>

</footer>
<a href="https://github.com/MichaelCurrin/dev-cheatsheets"
    class="github-corner" aria-label="View source on GitHub">
    <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
    </svg>
</a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

</body>

</html>
