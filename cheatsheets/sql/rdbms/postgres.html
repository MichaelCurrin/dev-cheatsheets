<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">



    <meta property="og:site_name" content="Dev Cheatsheets" />

    <title>Postgres | Dev Cheatsheets</title>

    <meta property="og:title" content="Postgres" />

    <meta name="twitter:card" content="summary" />
    <meta property="twitter:title" content="Postgres" />
<meta name="generator" content="Jekyll v4.2.2" />

<meta property="og:locale" content="en_US" />


    <meta name="description" content="A collection of code snippets and CLI guides for quick and easy reference while coding" />
    <meta property="og:description" content="A collection of code snippets and CLI guides for quick and easy reference while coding" />
<meta name="author" content="Michael Currin" />



<link rel="canonical" href="https://michaelcurrin.github.io/dev-cheatsheets/cheatsheets/sql/rdbms/postgres.html" />
<meta property="og:url" content="https://michaelcurrin.github.io/dev-cheatsheets/cheatsheets/sql/rdbms/postgres.html" />


<script type="application/ld+json">
{
    "name":        "Dev Cheatsheets",
    "description": "A collection of code snippets and CLI guides for quick and easy reference while coding",
    "url":         "https://michaelcurrin.github.io/dev-cheatsheets/cheatsheets/sql/rdbms/postgres.html",
    "headline":    "Postgres",
    "@type":       "WebSite",
    "@context":    "https://schema.org",
    "author": {
        "@type":"Person",
        "name": "Michael Currin"
    }
}
</script>
<link rel="stylesheet" href="/dev-cheatsheets/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://michaelcurrin.github.io/dev-cheatsheets/feed.xml" title="Dev Cheatsheets" /><script async src="https://www.googletagmanager.com/gtag/js?id=UA-87705880-12"></script>
    <script>
        window['ga-disable-UA-87705880-12'] = window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1";
        window.dataLayer = window.dataLayer || [];

        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-87705880-12');
    </script></head>
<body>
<header class="site-header" role="banner">

    <div class="wrapper"><a class="site-title" rel="author" href="/dev-cheatsheets/">
            Dev Cheatsheets
        </a><nav class="site-nav">
                <input type="checkbox" id="nav-trigger" class="nav-trigger" />

                <label for="nav-trigger">
                    <span class="menu-icon">
                        <svg viewBox="0 0 18 15" width="18px" height="15px">
                            <path
                                d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z" />
                        </svg>
                    </span>
                </label>

                <div class="trigger"><a class="page-link" href="/dev-cheatsheets/">
                                Home
                            </a><a class="page-link" href="/dev-cheatsheets/cheatsheets/">
                                Cheatsheets
                            </a><a class="page-link" href="/dev-cheatsheets/about.html">
                                About
                            </a></div>
            </nav></div>
</header>
<main class="page-content" aria-label="Content">
        <div class="wrapper">
            <a id="github-edit" href="https://github.com/MichaelCurrin/dev-cheatsheets/edit/master/cheatsheets/sql/rdbms/postgres.md">
    üìù <span>Edit page</span>
</a>

            <a id="github-add" href="https://github.com/MichaelCurrin/dev-cheatsheets/new/master/cheatsheets/sql/rdbms/">
    ‚ûï <span>Add page</span>
</a>


            

<article class="post">
    <header class="post-header">
        <h1 class="post-title">
            


<span class="logo-medium"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>PostgreSQL</title><path fill="currentColor" d="M23.5594 14.7228a.5269.5269 0 0 0-.0563-.1191c-.139-.2632-.4768-.3418-1.0074-.2321-1.6533.3411-2.2935.1312-2.5256-.0191 1.342-2.0482 2.445-4.522 3.0411-6.8297.2714-1.0507.7982-3.5237.1222-4.7316a1.5641 1.5641 0 0 0-.1509-.235C21.6931.9086 19.8007.0248 17.5099.0005c-1.4947-.0158-2.7705.3461-3.1161.4794a9.449 9.449 0 0 0-.5159-.0816 8.044 8.044 0 0 0-1.3114-.1278c-1.1822-.0184-2.2038.2642-3.0498.8406-.8573-.3211-4.7888-1.645-7.2219.0788C.9359 2.1526.3086 3.8733.4302 6.3043c.0409.818.5069 3.334 1.2423 5.7436.4598 1.5065.9387 2.7019 1.4334 3.582.553.9942 1.1259 1.5933 1.7143 1.7895.4474.1491 1.1327.1441 1.8581-.7279.8012-.9635 1.5903-1.8258 1.9446-2.2069.4351.2355.9064.3625 1.39.3772a.0569.0569 0 0 0 .0004.0041 11.0312 11.0312 0 0 0-.2472.3054c-.3389.4302-.4094.5197-1.5002.7443-.3102.064-1.1344.2339-1.1464.8115-.0025.1224.0329.2309.0919.3268.2269.4231.9216.6097 1.015.6331 1.3345.3335 2.5044.092 3.3714-.6787-.017 2.231.0775 4.4174.3454 5.0874.2212.5529.7618 1.9045 2.4692 1.9043.2505 0 .5263-.0291.8296-.0941 1.7819-.3821 2.5557-1.1696 2.855-2.9059.1503-.8707.4016-2.8753.5388-4.1012.0169-.0703.0357-.1207.057-.1362.0007-.0005.0697-.0471.4272.0307a.3673.3673 0 0 0 .0443.0068l.2539.0223.0149.001c.8468.0384 1.9114-.1426 2.5312-.4308.6438-.2988 1.8057-1.0323 1.5951-1.6698zM2.371 11.8765c-.7435-2.4358-1.1779-4.8851-1.2123-5.5719-.1086-2.1714.4171-3.6829 1.5623-4.4927 1.8367-1.2986 4.8398-.5408 6.108-.13-.0032.0032-.0066.0061-.0098.0094-2.0238 2.044-1.9758 5.536-1.9708 5.7495-.0002.0823.0066.1989.0162.3593.0348.5873.0996 1.6804-.0735 2.9184-.1609 1.1504.1937 2.2764.9728 3.0892.0806.0841.1648.1631.2518.2374-.3468.3714-1.1004 1.1926-1.9025 2.1576-.5677.6825-.9597.5517-1.0886.5087-.3919-.1307-.813-.5871-1.2381-1.3223-.4796-.839-.9635-2.0317-1.4155-3.5126zm6.0072 5.0871c-.1711-.0428-.3271-.1132-.4322-.1772.0889-.0394.2374-.0902.4833-.1409 1.2833-.2641 1.4815-.4506 1.9143-1.0002.0992-.126.2116-.2687.3673-.4426a.3549.3549 0 0 0 .0737-.1298c.1708-.1513.2724-.1099.4369-.0417.156.0646.3078.26.3695.4752.0291.1016.0619.2945-.0452.4444-.9043 1.2658-2.2216 1.2494-3.1676 1.0128zm2.094-3.988-.0525.141c-.133.3566-.2567.6881-.3334 1.003-.6674-.0021-1.3168-.2872-1.8105-.8024-.6279-.6551-.9131-1.5664-.7825-2.5004.1828-1.3079.1153-2.4468.079-3.0586-.005-.0857-.0095-.1607-.0122-.2199.2957-.2621 1.6659-.9962 2.6429-.7724.4459.1022.7176.4057.8305.928.5846 2.7038.0774 3.8307-.3302 4.7363-.084.1866-.1633.3629-.2311.5454zm7.3637 4.5725c-.0169.1768-.0358.376-.0618.5959l-.146.4383a.3547.3547 0 0 0-.0182.1077c-.0059.4747-.054.6489-.115.8693-.0634.2292-.1353.4891-.1794 1.0575-.11 1.4143-.8782 2.2267-2.4172 2.5565-1.5155.3251-1.7843-.4968-2.0212-1.2217a6.5824 6.5824 0 0 0-.0769-.2266c-.2154-.5858-.1911-1.4119-.1574-2.5551.0165-.5612-.0249-1.9013-.3302-2.6462.0044-.2932.0106-.5909.019-.8918a.3529.3529 0 0 0-.0153-.1126 1.4927 1.4927 0 0 0-.0439-.208c-.1226-.4283-.4213-.7866-.7797-.9351-.1424-.059-.4038-.1672-.7178-.0869.067-.276.1831-.5875.309-.9249l.0529-.142c.0595-.16.134-.3257.213-.5012.4265-.9476 1.0106-2.2453.3766-5.1772-.2374-1.0981-1.0304-1.6343-2.2324-1.5098-.7207.0746-1.3799.3654-1.7088.5321a5.6716 5.6716 0 0 0-.1958.1041c.0918-1.1064.4386-3.1741 1.7357-4.4823a4.0306 4.0306 0 0 1 .3033-.276.3532.3532 0 0 0 .1447-.0644c.7524-.5706 1.6945-.8506 2.802-.8325.4091.0067.8017.0339 1.1742.081 1.939.3544 3.2439 1.4468 4.0359 2.3827.8143.9623 1.2552 1.9315 1.4312 2.4543-1.3232-.1346-2.2234.1268-2.6797.779-.9926 1.4189.543 4.1729 1.2811 5.4964.1353.2426.2522.4522.2889.5413.2403.5825.5515.9713.7787 1.2552.0696.087.1372.1714.1885.245-.4008.1155-1.1208.3825-1.0552 1.717-.0123.1563-.0423.4469-.0834.8148-.0461.2077-.0702.4603-.0994.7662zm.8905-1.6211c-.0405-.8316.2691-.9185.5967-1.0105a2.8566 2.8566 0 0 0 .135-.0406 1.202 1.202 0 0 0 .1342.103c.5703.3765 1.5823.4213 3.0068.1344-.2016.1769-.5189.3994-.9533.6011-.4098.1903-1.0957.333-1.7473.3636-.7197.0336-1.0859-.0807-1.1721-.151zm.5695-9.2712c-.0059.3508-.0542.6692-.1054 1.0017-.055.3576-.112.7274-.1264 1.1762-.0142.4368.0404.8909.0932 1.3301.1066.887.216 1.8003-.2075 2.7014a3.5272 3.5272 0 0 1-.1876-.3856c-.0527-.1276-.1669-.3326-.3251-.6162-.6156-1.1041-2.0574-3.6896-1.3193-4.7446.3795-.5427 1.3408-.5661 2.1781-.463zm.2284 7.0137a12.3762 12.3762 0 0 0-.0853-.1074l-.0355-.0444c.7262-1.1995.5842-2.3862.4578-3.4385-.0519-.4318-.1009-.8396-.0885-1.2226.0129-.4061.0666-.7543.1185-1.0911.0639-.415.1288-.8443.1109-1.3505.0134-.0531.0188-.1158.0118-.1902-.0457-.4855-.5999-1.938-1.7294-3.253-.6076-.7073-1.4896-1.4972-2.6889-2.0395.5251-.1066 1.2328-.2035 2.0244-.1859 2.0515.0456 3.6746.8135 4.8242 2.2824a.908.908 0 0 1 .0667.1002c.7231 1.3556-.2762 6.2751-2.9867 10.5405zm-8.8166-6.1162c-.025.1794-.3089.4225-.6211.4225a.5821.5821 0 0 1-.0809-.0056c-.1873-.026-.3765-.144-.5059-.3156-.0458-.0605-.1203-.178-.1055-.2844.0055-.0401.0261-.0985.0925-.1488.1182-.0894.3518-.1226.6096-.0867.3163.0441.6426.1938.6113.4186zm7.9305-.4114c.0111.0792-.049.201-.1531.3102-.0683.0717-.212.1961-.4079.2232a.5456.5456 0 0 1-.075.0052c-.2935 0-.5414-.2344-.5607-.3717-.024-.1765.2641-.3106.5611-.352.297-.0414.6111.0088.6356.1851z"/></svg></span>



            <span>Postgres</span>
        </h1>

        
    </header>

    


    <div id="breadcrumbs">

    
        

        
            
            <a href="/dev-cheatsheets/cheatsheets/">
    Cheatsheets
</a>

        
     
        
            /
        

        
            
            <a href="/dev-cheatsheets/cheatsheets/sql/">
    SQL
</a>

        
     
        
            /
        

        
            
            <a href="/dev-cheatsheets/cheatsheets/sql/rdbms/">
    RDBMS flavors
</a>

        
     
        
            /
        

        
            <a href="/dev-cheatsheets/cheatsheets/sql/rdbms/postgres.html" class="underline">
                Postgres
            </a>
        
     
    </div>



    <br>

    <div class="post-content">
        
            <h2 id="resources">Resources</h2>

<ul>
  <li><a href="https://www.postgresql.org/about/">Homepage</a> on Postgres homepage.
    <blockquote>
      <p>PostgreSQL: The World‚Äôs Most Advanced Open Source Relational Database</p>
    </blockquote>
  </li>
  <li><a href="https://www.postgresql.org/about/">About</a> on Postgres homepage.</li>
</ul>

<h2 id="docs-and-tutorials">Docs and tutorials</h2>

<ul>
  <li><a href="https://www.postgresql.org/docs/">postgresql.org/docs/</a></li>
  <li><a href="https://www.postgresqltutorial.com/">postgresqltutorial.com</a>
    <ul>
      <li><a href="https://www.postgresqltutorial.com/postgresql-cheat-sheet/">Postgres Cheatsheet</a></li>
    </ul>
  </li>
</ul>

<h2 id="show">Show</h2>

<h3 id="show-database">Show database</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\l
</code></pre></div></div>

<p><a href="https://www.postgresqltutorial.com/postgresql-show-databases/">source</a></p>

<p>In the CLI:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>psql <span class="nt">-U</span> postgres <span class="nt">-l</span>
</code></pre></div></div>

<p>Recommended - specify a user as the default is <code class="language-plaintext highlighter-rouge">root</code> and you‚Äôll get an error if that does not exist.</p>

<h3 id="tables">Tables</h3>

<p>Show all tables.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postgres=# \dt
</code></pre></div></div>

<p>For more info.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postgres=# \dt+
</code></pre></div></div>

<p>Get info on a table.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postgres=# \d+ table_name
</code></pre></div></div>

<h2 id="use-database">Use database</h2>

<p>If you omit database name argument, the default of <code class="language-plaintext highlighter-rouge">postgres</code> will be used.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>psql <span class="nt">-U</span> postgres DB_NAME
</code></pre></div></div>

<h2 id="quit">Quit</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postgres=# \q
</code></pre></div></div>

<p>Or <kbd>CTRL</kbd>+<kbd>d</kbd>.</p>

<h2 id="users">Users</h2>

<h3 id="login">Login</h3>

<p>Here we use a user named <code class="language-plaintext highlighter-rouge">postgres</code>:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>psql <span class="nt">-U</span> postgres
</code></pre></div></div>

<p>The console will then look like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postgres=#
</code></pre></div></div>

<h3 id="create-user">Create user</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">USER</span> <span class="n">foo</span>
</code></pre></div></div>

<p>Recommended - use the optional <code class="language-plaintext highlighter-rouge">ENCRYPTED</code> modified.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">USER</span> <span class="n">foo</span> <span class="k">WITH</span> <span class="k">ENCRYPTED</span> <span class="n">PASSWORD</span> <span class="s1">'bar'</span><span class="p">;</span>
</code></pre></div></div>

<p>See <a href="https://www.postgresql.org/docs/current/app-createuser.html">create user</a> docs.</p>

<p>Grant priviledges:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">GRANT</span> <span class="k">ALL</span> <span class="k">PRIVILEGES</span> <span class="k">ON</span> <span class="k">DATABASE</span> <span class="n">my</span><span class="o">-</span><span class="n">db</span> <span class="k">TO</span> <span class="n">foo</span><span class="p">;</span>
</code></pre></div></div>

<p>Or create with the shell:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-u</span> postgres createuser foo
</code></pre></div></div>

<h3 id="create-role">Create role</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">ROLE</span> <span class="n">foo</span> <span class="n">LOGIN</span><span class="p">;</span>
</code></pre></div></div>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">ROLE</span> <span class="k">admin</span> <span class="k">WITH</span> <span class="k">CREATEDB</span> <span class="n">CREATEROLE</span><span class="p">;</span>
</code></pre></div></div>

<p><a href="https://www.postgresql.org/docs/current/sql-createrole.html">create role</a> docs.</p>

<h3 id="change-password">Change password</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">USER</span> <span class="n">postgres</span> <span class="k">WITH</span> <span class="n">PASSWORD</span> <span class="s1">'newpass'</span><span class="p">;</span>
</code></pre></div></div>

<p><a href="https://www.postgresql.org/docs/current/sql-alteruser.html">alter user</a> docs.</p>

<p>Set it interactively.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">postgres</span><span class="o">=#</span> <span class="err">\</span><span class="n">password</span>
</code></pre></div></div>

<p><a href="https://serverfault.com/questions/110154/whats-the-default-superuser-username-password-for-postgres-after-a-new-install/325596">question on forum</a></p>

<h3 id="list-users">List users</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">postgres</span><span class="o">=#</span> <span class="err">\</span><span class="n">du</span>
                                   <span class="n">List</span> <span class="k">of</span> <span class="n">roles</span>
 <span class="k">Role</span> <span class="n">name</span> <span class="o">|</span>                         <span class="n">Attributes</span>                         <span class="o">|</span> <span class="n">Member</span> <span class="k">of</span>
<span class="c1">-----------+------------------------------------------------------------+-----------</span>
 <span class="n">postgres</span>  <span class="o">|</span> <span class="n">Superuser</span><span class="p">,</span> <span class="k">Create</span> <span class="k">role</span><span class="p">,</span> <span class="k">Create</span> <span class="n">DB</span><span class="p">,</span> <span class="n">Replication</span><span class="p">,</span> <span class="n">Bypass</span> <span class="n">RLS</span> <span class="o">|</span> <span class="p">{}</span>
</code></pre></div></div>

<p>More details:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>postgres=# \du+
</code></pre></div></div>

<p><a href="https://www.postgresqltutorial.com/postgresql-list-users/">List users</a> PG tutorial.</p>

<h2 id="connect">Connect</h2>

<p>From the <a href="https://www.postgresql.org/docs/13/app-psql.html">docs</a>.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>psql <span class="s2">"service=myservice sslmode=require"</span>
<span class="nv">$ </span>psql postgresql://dbmaster:5433/mydb?sslmode<span class="o">=</span>require
</code></pre></div></div>

<h2 id="run-query-using-cli">Run query using CLI</h2>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>psql <span class="nt">-U</span> <span class="s2">"</span><span class="nv">$DB_USER</span><span class="s2">"</span> <span class="nt">-d</span> <span class="s2">"</span><span class="nv">$DB_NAME</span><span class="s2">"</span> <span class="nt">-c</span> <span class="s2">"SELECT COUNT(*) FROM my_table"</span>
</code></pre></div></div>

<p>Or you can pass the name of a <code class="language-plaintext highlighter-rouge">.sql</code> file.</p>

<p>If using a remote database, add host:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>psql <span class="nt">-h</span> <span class="s2">"</span><span class="nv">$HOST</span><span class="s2">"</span> ...
</code></pre></div></div>

<h2 id="passwords">Passwords</h2>

<p>If you database is password-protected.</p>

<p>You can get prompted in the CLI to enter a password.</p>

<p>Or enter password using an approach here.</p>

<h3 id="env-vars">Env vars</h3>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ PGPASSWORD</span><span class="o">=</span>123 psql ...
</code></pre></div></div>
<p><a href="http://www.postgresql.org/docs/current/static/libpq-envars.html">env vars</a> manual.</p>

<h3 id="pg-pass">PG pass</h3>

<p>Use a <code class="language-plaintext highlighter-rouge">.pgpass</code> file to store the password. <a href="http://www.postgresql.org/docs/current/static/libpq-pgpass.html">pgpass</a> manual.</p>

<h4 id="trust-authentication">Trust authentication</h4>

<p>For that specific user:</p>

<p><a href="http://www.postgresql.org/docs/current/static/auth-methods.html#AUTH-TRUST">Auth trust</a>.</p>

<h4 id="connection-uri">Connection URI</h4>

<p>Use a connection string that contains everything:</p>

<p><a href="http://www.postgresql.org/docs/current/static/libpq-connect.html#AEN42532">Connect</a> in manual.</p>

<h2 id="dump-and-restore">Dump and restore</h2>

<h3 id="dump">Dump</h3>

<p>Create a dump from a DB:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pg_dump <span class="nt">--format</span><span class="o">=</span>custom db_name <span class="o">&gt;</span> db_name.dump
</code></pre></div></div>

<p>See <a href="https://www.postgresql.org/docs/current/app-pgdump.html">pg_dump</a> docs.</p>

<blockquote>
  <p>pg_dump ‚Äî extract a PostgreSQL database into a script file or other archive file</p>

  <p>pg_dump is a utility for backing up a PostgreSQL database. It makes consistent backups even if the database is being used concurrently. pg_dump does not block other users accessing the database (readers or writers).</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pg_dump [connection-option...] [option...] [dbname]
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">-F, --format FORMAT</code> - The default format is <code class="language-plaintext highlighter-rouge">p</code> or <code class="language-plaintext highlighter-rouge">plain</code> for plain text SQL. Use <code class="language-plaintext highlighter-rouge">c</code> or <code class="language-plaintext highlighter-rouge">custom</code> as a compressed archive which is the most flexible option. Also <code class="language-plaintext highlighter-rouge">d</code> or <code class="language-plaintext highlighter-rouge">directory</code> and <code class="language-plaintext highlighter-rouge">t</code> or <code class="language-plaintext highlighter-rouge">tar</code> are options. e.g. <code class="language-plaintext highlighter-rouge">-Fc</code> note no equals sign.</li>
  <li><code class="language-plaintext highlighter-rouge">-f, --file PATH</code> - path to write to, otherwise will write to stdout.</li>
</ul>

<p>e.g.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pg_dump <span class="nt">-U</span> my-user <span class="nt">-d</span> db-name <span class="nt">-Fc</span> <span class="nt">-h</span> abcdef.eu-central-1.rds.amazonaws.com <span class="nt">-f</span> db.pgdump
</code></pre></div></div>

<h3 id="restore">Restore</h3>

<p>Drop the database and recreate it from a dump:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dropdb db_name
<span class="nv">$ </span>pg_restore <span class="nt">-C</span> <span class="nt">-d</span> db_name db_name.dump
</code></pre></div></div>

<p>See <a href="https://www.postgresql.org/docs/current/app-pgrestore.html">pg_restore</a> docs.</p>

<blockquote>
  <p>pg_restore ‚Äî restore a PostgreSQL database from an archive file created by pg_dump</p>

  <p>pg_restore is a utility for restoring a PostgreSQL database from an archive created by pg_dump in one of the non-plain-text formats</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pg_restore [connection-option...] [option...] [filename]
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">-C, --create</code> - Create the database before restoring into it.</li>
  <li><code class="language-plaintext highlighter-rouge">-c, --clean</code> - drop the DB first.</li>
  <li><code class="language-plaintext highlighter-rouge">--if-exists</code> - to be used with the clean flag.</li>
</ul>

<p>The database comes from within the dump (unlike with plain SQL) so you don‚Äôt need to specify it.</p>

<p>e.g.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>dropdb <span class="nt">-U</span> my-user db-name
<span class="nv">$ </span>pg_restore <span class="nt">-U</span> my-user db.pgdump
</code></pre></div></div>

<p>Another option for restoring is using <code class="language-plaintext highlighter-rouge">psql</code> and a plain-text SQL file. Note that you might have to create the DB first before you first into it.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>psql postgres://postgres:<span class="nv">$POSTGRES_PASSWORD</span>@<span class="nv">$POSTGRES_HOST</span> &lt; db.sql
</code></pre></div></div>

<p>Or if on the same host like for local dev or inside a Postgres container.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>psql <span class="nt">-U</span> my-user <span class="nt">-d</span> db-name &lt; db.sql
</code></pre></div></div>

<h3 id="dump-cluster">Dump cluster</h3>

<p>From <a href="https://www.postgresql.org/docs/current/app-pg-dumpall.html">pg_dumpall</a> docs.</p>

<p>This is useful if you have several databases to dump or need to dump the roles for users, which exists at the cluster level so don‚Äôt appear in a <code class="language-plaintext highlighter-rouge">pg_dump</code> dump.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>pg_dumpall <span class="o">&gt;</span> db.out
</code></pre></div></div>

<p>Some flags:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">--clean</code></li>
  <li><code class="language-plaintext highlighter-rouge">-f, --file FILENAME</code></li>
  <li><code class="language-plaintext highlighter-rouge">--roles-only</code></li>
</ul>

<p>Reload database(s) from this file, you can use:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>psql <span class="nt">-f</span> db.out postgres
</code></pre></div></div>

<blockquote>
  <p>It is not important to which database you connect here since the script file created by <code class="language-plaintext highlighter-rouge">pg_dumpall</code> will contain the appropriate commands to create and connect to the saved databases.</p>

  <p>An exception is that if you specified <code class="language-plaintext highlighter-rouge">--clean</code>, you must connect to the postgres database initially; the script will attempt to drop other databases immediately, and that will fail for the database you are connected to.</p>
</blockquote>


        
    </div>
</article>

        </div>
    </main>
<footer class="site-footer h-card">
    <data class="u-url" href="/dev-cheatsheets/"></data>

    <div class="wrapper">

        <h2 class="footer-heading">Dev Cheatsheets</h2>

        <div class="footer-col-wrapper">
            <div class="footer-col footer-col-1">
                <ul class="contact-list"><li class="p-name">
                            Michael Currin
                        </li></ul>
            </div>

            <div class="footer-col footer-col-2">
<ul class="social-media-list"><li>
            <a href="https://github.com/MichaelCurrin"><svg class="svg-icon">
                    <use xlink:href="/dev-cheatsheets/assets/fractal-social-icons.svg#github"></use>
                </svg> <span class="username">MichaelCurrin</span></a>
        </li></ul>
</div>

            <div class="footer-col footer-col-3">
                <p>A collection of code snippets and CLI guides for quick and easy reference while coding</p>
            </div>
        </div>

    </div>

</footer>
<a href="https://github.com/MichaelCurrin/dev-cheatsheets"
    class="github-corner" aria-label="View source on GitHub">
    <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
    </svg>
</a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

</body>

</html>
